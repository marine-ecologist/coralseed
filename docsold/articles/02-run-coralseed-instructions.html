<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="coralseed">
<title>2. Instructions for running coralseed • coralseed</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2. Instructions for running coralseed">
<meta property="og:description" content="coralseed">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">coralseed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01-coralseed-theory.html">1: Introduction and coralseed theory</a>
    <a class="dropdown-item" href="../articles/02-run-coralseed-instructions.html">2. Instructions for running coralseed</a>
    <a class="dropdown-item" href="../articles/03-generating-summary-statistics.html">3. Quantifying spatial footprints from coralseed outputs</a>
    <a class="dropdown-item" href="../articles/04-visualising-coralseed-outputs.html">4. Visualising coralseed outputs</a>
    <a class="dropdown-item" href="../articles/05-parallel-processing.html">5. Parallel / multicore processing coralseed for large dispersal inputs</a>
    <a class="dropdown-item" href="../articles/06-posterior-variance-checks.html">6. Posterior variance checks (dispersal &amp; coralseed models)</a>
    <a class="dropdown-item" href="../articles/07-coralseed-mermaid.html">Example i) : Mermaid Bay, Lizard Island</a>
    <a class="dropdown-item" href="../articles/08-coralseed-palfreyn.html">Example ii) : Palfrey North, Lizard Island</a>
    <a class="dropdown-item" href="../articles/09-coralseed-spawnhub.html">Example iii): Spawn Hub, Lizard Island</a>
    <a class="dropdown-item" href="../articles/10-coralseed-watsons.html">Example iv): Watsons Bay North, Lizard Island</a>
    <a class="dropdown-item" href="../articles/11-coralseed-clamgarden.html">Example v) : Clam Garden, Lizard Island</a>
    <a class="dropdown-item" href="../articles/test.html">Writing Vignette with the 'minidown' Package</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>2. Instructions for running coralseed</h1>
            
            <h4 data-toc-skip class="date">2023-09-23</h4>
      
      
      <div class="d-none name"><code>02-run-coralseed-instructions.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="mermaid-bay-lizard-island">Mermaid Bay, Lizard Island<a class="anchor" aria-label="anchor" href="#mermaid-bay-lizard-island"></a>
</h3>
<p>Below is an example running <code>coralseed</code> using a dataset
from Mermaid Bay, Lizard Island (nGBR), December 2022. The model
simulates a point source release of 1000 particles from a 5*5m area
within the site and tracks particles across a 6.95hrs period.</p>
</div>
<div class="section level3">
<h3 id="load-packages-and-set-seascape_probability">1. Load packages and set seascape_probability<a class="anchor" aria-label="anchor" href="#load-packages-and-set-seascape_probability"></a>
</h3>
<p>First step is to generate a probabilistic habitat map for settlement.
The <code>seascape_probability</code> function takes two shp files as
inputs: 1) a map of reef substrates (merged classes of “coral/algae”,
“rubble”, “rock” from the Allan Coral Atlas Benthic classes), and 2) a
map of benthic habitat (e.g. “reef crest”, “reef slope” etc classes from
geomorphic Allan Coral Atlas maps). The function generates a probability
mosaic for settleable area (reef substrates) categorised by habitat
types. Example <code>reef_outline</code> and <code>habitat</code> files
are included for Lizard Island. To change the probabilities see
<code>?settlement_probability</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marine-ecologist.github.io/coralseed/" class="external-link">coralseed</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">seascape</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seascape_probability.html">seascape_probability</a></span><span class="op">(</span>reefoutline<span class="op">=</span><span class="va">reef_map</span>, habitat<span class="op">=</span><span class="va">benthic_map</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="seed-particles-based-on-dispersal-input">2. Seed particles based on dispersal input<a class="anchor" aria-label="anchor" href="#seed-particles-based-on-dispersal-input"></a>
</h3>
<p>The second step is to simulate individual competency tracks for
particles/larvae, incorporate larval mortality, and determine settlement
probability as particles/larvae pass over reef habitats. The
<code>seed_particles</code> function does this by taking the input
simulated particles, overlaying the probability <code>seascape</code>
generated in step 1, and uses <code>predict_competency</code> and
<code>simulate_mortality</code> to quantify competency and mortality
respectively (see <code><a href="../reference/predict_competency.html">?predict_competency</a></code> and
<code><a href="../reference/simulate_mortality.html">?simulate_mortality</a></code> for more details). The example below
uses one of the included simulated particle tracks
(“Mermaid_PointSource_Bay_01”) as <code>input</code> and the seascape
probability (<code>seascape</code>) generated in the previous step to
track particles across a ~7hr period (<code>limit_time</code>).
Mortality is set to 10% (<code>simulate.mortality</code>) and the shape
of the mortality curve (<code>simulate.mortality</code>) is set to
“typeI”. Settlement probability for particles passing over substrates
(<code>probability</code>) is set to “additive” (see
<code><a href="../reference/settle_particles.html">?settle_particles</a></code>) for further details.</p>
<p><code>seed_particles</code> outputs summary statistics (set
<code>silent=FALSE</code>) and summary plots of the main outputs
(competency, mortality, spatial pattern (cartesian) and dispersaltime -
set <code>return.plot=TRUE</code> to visualise these). Try changing the
parameters and visualising the output.</p>
<p>The function returns an <code>sf</code> output in with spatial points
for each individual particle (<code>id</code>) at 1 minute timesteps
(<code>dispersaltime</code>) across trajectories and details the time in
minutes when each particle becomes competent
(<code>settlement_point</code>), the particle <code>state</code> (either
0 or 1) and <code>competency</code> (incompetent or competent), the
benthic habitat it crosses at that point in time (<code>class</code>),
unique habitat identifier (<code>habitat_id</code>) and
<code>settlement_probability</code> for each habitat determined from the
previous step, the <code>settlement_outcome</code> (i.e. was the
particle competent AND probable to settle?), and finally the
<code>outcome</code> (i.e. the transition between 0 and 1 is the final
settlement point for a given particle).</p>
<!-- # ```{r, results='asis', fig.width=8, fig.height=6} -->
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">particles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seed_particles.html">seed_particles</a></span><span class="op">(</span>input<span class="op">=</span><span class="st">"example-mermaid"</span>, seascape<span class="op">=</span><span class="va">seascape</span>,</span>
<span>                            competency.function <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>                            limit_time<span class="op">=</span><span class="fl">6</span>, simulate.mortality <span class="op">=</span> <span class="st">"typeI"</span>, </span>
<span>                            simulate.mortality.n <span class="op">=</span> <span class="fl">0.1</span>, probability<span class="op">=</span><span class="st">"additive"</span>,</span>
<span>                            return.plot<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="settle-particles-based-on-benthic-habitats-and-probability">3. Settle particles based on benthic habitats and probability<a class="anchor" aria-label="anchor" href="#settle-particles-based-on-benthic-habitats-and-probability"></a>
</h3>
<p>The <code>settle_particles</code> function takes the input from
<code>seed_particles</code> and determines where along the settlement
track each particle settles. As there’s currently no data on how larvae
settle and interact in the wild, the function adds three different
possibilities: “additive” (if p=1 AND larvae are competent, larvae
settle somewhere in that habitat along the particle trajectory),
“lagged” (if p=1 AND larvae are competent, larvae settle somewhere in
the habitat in the first 10 minutes, and “rapid” (if p=1 AND larvae are
competent, larvae settle immediately once entering the habitat.</p>
<p>All larvae that are competent will settle somewhere in a habitat if
p=1. “rapid” will produce unrealistic results as larvae will immediately
settle on the borders of habitats. “lagged” is probably more realistic,
but given that habitats are relatively small in size (seascapes are
spatially complex) and most larvae pass through habitats fairly rapidly,
either “lagged” or “additive” will produce fairly realistic results.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settlers</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/settle_particles.html">settle_particles</a></span><span class="op">(</span><span class="va">particles</span>, probability<span class="op">=</span><span class="st">"additive"</span>, silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="map-the-output">4. Map the output<a class="anchor" aria-label="anchor" href="#map-the-output"></a>
</h3>
<p>To spatially map all the above outputs, use the
<code>map_coralseed</code> function. <code>map_coralseed</code> takes
the outputs from steps 1 (<code>seascape_probability</code>), step 2
(<code>seed_particles</code>), and step 3
(<code>settle_particles</code>) as inputs and uses the <code>tmap</code>
library to plot the shp files, particle tracks, and settlement points.
The <code>restoration.plot</code> function takes a vector of width and
length and draws a rectangular area over the centroid of the particle
release.</p>
<iframe src="articles/02-map-01.html" width="900" height="900">
</iframe>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by George Roff.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
