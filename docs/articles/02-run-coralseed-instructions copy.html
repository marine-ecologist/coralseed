<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. Example code for running coralseed • coralseed</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. Example code for running coralseed">
<meta property="og:description" content="coralseed">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">coralseed</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-coralseed-theory.html">1: coralseed theory</a>
    </li>
    <li>
      <a href="../articles/02-run-coralseed-instructions%20copy.html">2. Example code for running coralseed</a>
    </li>
    <li>
      <a href="../articles/02-run-coralseed-instructions.html">2. Example code for running coralseed</a>
    </li>
    <li>
      <a href="../articles/03-generating-summary-statistics.html">4. Quantifying spatial footprints from coralseed</a>
    </li>
    <li>
      <a href="../articles/04-parallel-processing.html">3. Parallel processing with coralseed</a>
    </li>
    <li>
      <a href="../articles/05-posterior-variance-checks.html">Explore posterior draws in coralseed</a>
    </li>
    <li>
      <a href="../articles/06-coralseed-clamgarden.html">Example i) : Clam Garden, Lizard Island</a>
    </li>
    <li>
      <a href="../articles/07-coralseed-mermaidbay.html">Example ii): Mermaid Bay, Lizard Island</a>
    </li>
    <li>
      <a href="../articles/08-coralseed-palfreyn.html">Example iii) : Palfrey North, Lizard Island</a>
    </li>
    <li>
      <a href="../articles/09-coralseed-spawnhub.html">Example iv): Spawn Hub, Lizard Island</a>
    </li>
    <li>
      <a href="../articles/10-coralseed-watsons.html">Example v): Watsons Bay North, Lizard Island</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2. Example code for running coralseed</h1>
            
            <h4 data-toc-skip class="date">2023-09-21</h4>
      
      
      <div class="hidden name"><code>02-run-coralseed-instructions copy.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="mermaid-bay-lizard-island">Mermaid Bay, Lizard Island<a class="anchor" aria-label="anchor" href="#mermaid-bay-lizard-island"></a>
</h3>
<p>Below is an example running <code>coralseed</code> using a dataset
from Mermaid Bay, Lizard Island (nGBR), December 2022. The model
simulates a point source release of 1000 particles from a 5*5m area
within the site and tracks particles across a 6.95hrs period.</p>
</div>
<div class="section level3">
<h3 id="load-packages-and-set-seascape_probability">1. Load packages and set seascape_probability<a class="anchor" aria-label="anchor" href="#load-packages-and-set-seascape_probability"></a>
</h3>
<p>First step is to generate a probabilistic habitat map for settlement.
The <code>seascape_probability</code> function takes two shp files as
inputs: 1) a map of reef substrates (merged classes of “coral/algae”,
“rubble”, “rock” from the Allan Coral Atlas Benthic classes), and 2) a
map of benthic habitat (e.g. “reef crest”, “reef slope” etc classes from
geomorphic Allan Coral Atlas maps). The function generates a probability
mosaic for settleable area (reef substrates) categorised by habitat
types. Example <code>reef_outline</code> and <code>habitat</code> files
are included for Lizard Island. To change the probabilities see
<code>?settlement_probability</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="st">"/Users/rof011/coralseed"</span><span class="op">)</span></span>
<span><span class="co">#library(coralseed)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bhaskarvk/widgetframe" class="external-link">widgetframe</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ramnathv/htmlwidgets" class="external-link">htmlwidgets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">seascape</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seascape_probability.html">seascape_probability</a></span><span class="op">(</span>reefoutline<span class="op">=</span><span class="va">reef_map</span>, habitat<span class="op">=</span><span class="va">benthic_map</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="seed-particles-based-on-dispersal-input">2. Seed particles based on dispersal input<a class="anchor" aria-label="anchor" href="#seed-particles-based-on-dispersal-input"></a>
</h3>
<p>The second step is to simulate individual competency tracks for
particles/larvae, incorporate larval mortality, and determine settlement
probability as particles/larvae pass over reef habitats. The
<code>seed_particles</code> function does this by taking the input
simulated particles, overlaying the probability <code>seascape</code>
generated in step 1, and uses <code>predict_competency</code> and
<code>simulate_mortality</code> to quantify competency and mortality
respectively (see <code><a href="../reference/predict_competency.html">?predict_competency</a></code> and
<code><a href="../reference/simulate_mortality.html">?simulate_mortality</a></code> for more details). The example below
uses one of the included simulated particle tracks
(“Mermaid_PointSource_Bay_01”) as <code>input</code> and the seascape
probability (<code>seascape</code>) generated in the previous step to
track particles across a ~7hr period (<code>limit_time</code>).
Mortality is set to 10% (<code>simulate.mortality</code>) and the shape
of the mortality curve (<code>simulate.mortality</code>) is set to
“typeI”. Settlement probability for particles passing over substrates
(<code>probability</code>) is set to “additive” (see
<code><a href="../reference/settle_particles.html">?settle_particles</a></code>) for further details.</p>
<p><code>seed_particles</code> outputs summary statistics (set
<code>silent=FALSE</code>) and summary plots of the main outputs
(competency, mortality, spatial pattern (cartesian) and dispersaltime -
set <code>return.plot=TRUE</code> to visualise these). Try changing the
parameters and visualising the output.</p>
<p>The function returns an <code>sf</code> output in with spatial points
for each individual particle (<code>id</code>) at 1 minute timesteps
(<code>dispersaltime</code>) across trajectories and details the time in
minutes when each particle becomes competent
(<code>settlement_point</code>), the particle <code>state</code> (either
0 or 1) and <code>competency</code> (incompetent or competent), the
benthic habitat it crosses at that point in time (<code>class</code>),
unique habitat identifier (<code>habitat_id</code>) and
<code>settlement_probability</code> for each habitat determined from the
previous step, the <code>settlement_outcome</code> (i.e. was the
particle competent AND probable to settle?), and finally the
<code>outcome</code> (i.e. the transition between 0 and 1 is the final
settlement point for a given particle).</p>
<!-- # ```{r, results='asis', fig.width=8, fig.height=6} -->
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">particles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seed_particles.html">seed_particles</a></span><span class="op">(</span>input<span class="op">=</span><span class="st">"mermaid"</span>, seascape<span class="op">=</span><span class="va">seascape</span>,</span>
<span>                            competency.function <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>                            limit_time<span class="op">=</span><span class="fl">6</span>, simulate.mortality <span class="op">=</span> <span class="st">"typeI"</span>, </span>
<span>                            simulate.mortality.n <span class="op">=</span> <span class="fl">0.1</span>, probability<span class="op">=</span><span class="st">"additive"</span>,</span>
<span>                            return.plot<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="settle-particles-based-on-benthic-habitats-and-probability">3. Settle particles based on benthic habitats and probability<a class="anchor" aria-label="anchor" href="#settle-particles-based-on-benthic-habitats-and-probability"></a>
</h3>
<p>The <code>settle_particles</code> function takes the input from
<code>seed_particles</code> and determines where along the settlement
track each particle settles. As there’s currently no data on how larvae
settle and interact in the wild, the function adds three different
possibilities: “additive” (if p=1 AND larvae are competent, larvae
settle somewhere in that habitat along the particle trajectory),
“lagged” (if p=1 AND larvae are competent, larvae settle somewhere in
the habitat in the first 10 minutes, and “rapid” (if p=1 AND larvae are
competent, larvae settle immediately once entering the habitat.</p>
<p>All larvae that are competent will settle somewhere in a habitat if
p=1. “rapid” will produce unrealistic results as larvae will immediately
settle on the borders of habitats. “lagged” is probably more realistic,
but given that habitats are relatively small in size (seascapes are
spatially complex) and most larvae pass through habitats fairly rapidly,
either “lagged” or “additive” will produce fairly realistic results.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settlers</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/settle_particles.html">settle_particles</a></span><span class="op">(</span><span class="va">particles</span>, probability<span class="op">=</span><span class="st">"additive"</span>, silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="map-the-output">4. Map the output<a class="anchor" aria-label="anchor" href="#map-the-output"></a>
</h3>
<p>To spatially map all the above outputs, use the
<code>map_coralseed</code> function. <code>map_coralseed</code> takes
the outputs from steps 1 (<code>seascape_probability</code>), step 2
(<code>seed_particles</code>), and step 3
(<code>settle_particles</code>) as inputs and uses the <code>tmap</code>
library to plot the shp files, particle tracks, and settlement points.
The <code>restoration.plot</code> function takes a vector of width and
length and draws a rectangular area over the centroid of the particle
release.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">map_coralseed</span><span class="op">(</span>seed_particles<span class="op">=</span><span class="va">particles</span>, settle_particles<span class="op">=</span><span class="va">settlers</span>, </span>
<span>              seascape_probability<span class="op">=</span><span class="va">seascape</span>, restoration.plot<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">100</span><span class="op">)</span>, show.tracks <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/htmlwidgets/man/saveWidget.html" class="external-link">saveWidget</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">'tmp.html'</span>, selfcontained <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<iframe src="tmp.html" width="900" height="900">
</iframe>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by George Roff.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
